<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Shopping Assistant</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .hover-lift {
            transition: transform 0.2s ease-in-out;
        }
        
        .hover-lift:hover {
            transform: translateY(-2px);
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        .notification {
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .jow-ingredient-item {
            transition: all 0.2s ease;
        }

        .jow-ingredient-item:hover {
            background-color: #f8f9fa;
        }

        .quantity-input {
            width: 70px;
        }

        .unit-select {
            width: 100px;
        }

        .consolidated-badge {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Composant de notification toast
        const Toast = ({ message, type = 'info', onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 4000);
                return () => clearTimeout(timer);
            }, [onClose]);
            
            const bgColor = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            }[type];
            
            return (
                <div className={`fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg notification z-50`}>
                    <div className="flex items-center">
                        <span>{message}</span>
                        <button onClick={onClose} className="ml-3 text-white hover:text-gray-200">
                            <i className="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            );
        };
        
        // Composant principal
        const SmartShoppingApp = () => {
            // √âtats principaux
            const [activeTab, setActiveTab] = useState('shopping');
            const [shoppingList, setShoppingList] = useState([]);
            const [frequentItems, setFrequentItems] = useState([]);
            const [recipes, setRecipes] = useState([]);
            const [priceAlerts, setPriceAlerts] = useState([]);
            const [promotions, setPromotions] = useState([]);
            const [stats, setStats] = useState({});
            const [loading, setLoading] = useState(false);
            const [toast, setToast] = useState(null);
            
            // √âtats pour les formulaires
            const [newItem, setNewItem] = useState('');
            const [newCategory, setNewCategory] = useState('Divers');
            const [newRecipe, setNewRecipe] = useState({ name: '', ingredients: '' });
            
            // √âtats pour Jow
            const [jowSearchQuery, setJowSearchQuery] = useState('');
            const [jowRecipes, setJowRecipes] = useState([]);
            const [loadingJow, setLoadingJow] = useState(false);
            
            const API_BASE = '';
            
            // Fonction utilitaire pour afficher les toasts
            const showToast = (message, type = 'info') => {
                setToast({ message, type, id: Date.now() });
            };
            
            // Chargement initial des donn√©es
            useEffect(() => {
                loadAllData();
            }, []);
            
            const loadAllData = async () => {
                setLoading(true);
                try {
                    await Promise.all([
                        fetchShoppingList(),
                        fetchFrequentItems(),
                        fetchRecipes(),
                        fetchPriceAlerts(),
                        fetchPromotions(),
                        fetchStats()
                    ]);
                } catch (error) {
                    showToast('Erreur lors du chargement des donn√©es', 'error');
                } finally {
                    setLoading(false);
                }
            };
            
            // Fonctions API existantes
            const fetchShoppingList = async () => {
                try {
                    const response = await fetch(`${API_BASE}/api/shopping-list`);
                    const data = await response.json();
                    setShoppingList(data);
                } catch (error) {
                    console.error('Erreur chargement liste:', error);
                }
            };
            
            const fetchFrequentItems = async () => {
                try {
                    const response = await fetch(`${API_BASE}/api/frequent-items`);
                    const data = await response.json();
                    setFrequentItems(data);
                } catch (error) {
                    console.error('Erreur chargement suggestions:', error);
                }
            };
            
            const fetchRecipes = async () => {
                try {
                    const response = await fetch(`${API_BASE}/api/recipes`);
                    const data = await response.json();
                    setRecipes(data);
                } catch (error) {
                    console.error('Erreur chargement recettes:', error);
                }
            };
            
            const fetchPriceAlerts = async () => {
                try {
                    const response = await fetch(`${API_BASE}/api/price-alerts`);
                    const data = await response.json();
                    setPriceAlerts(data);
                } catch (error) {
                    console.error('Erreur chargement alertes:', error);
                }
            };
            
            const fetchPromotions = async () => {
                try {
                    const response = await fetch(`${API_BASE}/api/promotions`);
                    const data = await response.json();
                    setPromotions(data);
                } catch (error) {
                    console.error('Erreur chargement promotions:', error);
                }
            };
            
            const fetchStats = async () => {
                try {
                    const response = await fetch(`${API_BASE}/api/stats`);
                    const data = await response.json();
                    setStats(data);
                } catch (error) {
                    console.error('Erreur chargement stats:', error);
                }
            };
            
            // === NOUVELLES FONCTIONS JOW ===
            
            // Recherche de recettes Jow R√âELLE
            const searchJowRecipes = async () => {
                if (!jowSearchQuery.trim()) return;
                
                setLoadingJow(true);
                try {
                    const response = await fetch(`${API_BASE}/api/jow/search-recipes`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            query: jowSearchQuery,
                            limit: 6 
                        })
                    });
                    const data = await response.json();
                    if (data.success) {
                        setJowRecipes(data.data.recipes);
                        showToast(`${data.data.recipes.length} recettes trouv√©es sur Jow`, 'success');
                    } else {
                        showToast('Erreur lors de la recherche Jow: ' + data.error, 'error');
                    }
                } catch (error) {
                    showToast('Erreur de connexion √† Jow', 'error');
                    console.error('Erreur recherche Jow:', error);
                } finally {
                    setLoadingJow(false);
                }
            };
            
            // Mise √† jour quantit√© ingr√©dient Jow
            const updateJowIngredientQuantity = (recipeId, ingredientIndex, newQuantity) => {
                setJowRecipes(prev => prev.map(recipe => 
                    recipe.id === recipeId ? {
                        ...recipe,
                        ingredients: recipe.ingredients.map((ing, idx) => 
                            idx === ingredientIndex ? { ...ing, quantity: parseFloat(newQuantity) || 0 } : ing
                        )
                    } : recipe
                ));
            };
            
            // Mise √† jour unit√© ingr√©dient Jow
            const updateJowIngredientUnit = (recipeId, ingredientIndex, newUnit) => {
                setJowRecipes(prev => prev.map(recipe => 
                    recipe.id === recipeId ? {
                        ...recipe,
                        ingredients: recipe.ingredients.map((ing, idx) => 
                            idx === ingredientIndex ? { ...ing, unit: newUnit } : ing
                        )
                    } : recipe
                ));
            };
            
            // Ajouter recette Jow avec consolidation intelligente
            const addJowRecipeToList = async (recipe) => {
                try {
                    setLoading(true);
                    
                    // Appeler l'API de consolidation intelligente
                    const response = await fetch(`${API_BASE}/api/intelligent/consolidate-and-add`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            recipe: recipe,
                            existingList: shoppingList
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        // Actualiser la liste de courses
                        await fetchShoppingList();
                        
                        const consolidatedCount = result.data.consolidatedItems || 0;
                        const addedCount = result.data.addedItems || 0;
                        
                        if (consolidatedCount > 0) {
                            showToast(
                                `Recette "${recipe.name}" ajout√©e avec ${consolidatedCount} consolidations intelligentes!`,
                                'success'
                            );
                        } else {
                            showToast(
                                `Recette "${recipe.name}" ajout√©e (${addedCount} ingr√©dients)`,
                                'success'
                            );
                        }
                    } else {
                        showToast('Erreur lors de l\'ajout: ' + result.error, 'error');
                    }
                } catch (error) {
                    showToast('Erreur lors de l\'ajout de la recette', 'error');
                    console.error('Erreur ajout recette Jow:', error);
                } finally {
                    setLoading(false);
                }
            };
            
            // Gestion de la liste de courses (fonctions existantes)
            const addItem = async (name, category = newCategory) => {
                if (!name.trim()) return;
                
                try {
                    const response = await fetch(`${API_BASE}/api/shopping-list`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name: name.trim(), category }),
                    });
                    
                    if (response.ok) {
                        await fetchShoppingList();
                        await fetchFrequentItems();
                        setNewItem('');
                        showToast('Article ajout√© avec succ√®s', 'success');
                    }
                } catch (error) {
                    showToast('Erreur lors de l\'ajout', 'error');
                }
            };
            
            const toggleItem = async (id, checked) => {
                try {
                    await fetch(`${API_BASE}/api/shopping-list/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ checked }),
                    });
                    await fetchShoppingList();
                } catch (error) {
                    showToast('Erreur lors de la modification', 'error');
                }
            };
            
            const removeItem = async (id) => {
                try {
                    await fetch(`${API_BASE}/api/shopping-list/${id}`, {
                        method: 'DELETE',
                    });
                    await fetchShoppingList();
                    showToast('Article supprim√©', 'success');
                } catch (error) {
                    showToast('Erreur lors de la suppression', 'error');
                }
            };
            
            // Gestion des recettes (fonctions existantes)
            const addRecipe = async () => {
                if (!newRecipe.name.trim() || !newRecipe.ingredients.trim()) return;
                
                const ingredients = newRecipe.ingredients.split('\n').filter(i => i.trim());
                
                try {
                    const response = await fetch(`${API_BASE}/api/recipes`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name: newRecipe.name.trim(),
                            ingredients
                        }),
                    });
                    
                    if (response.ok) {
                        await fetchRecipes();
                        setNewRecipe({ name: '', ingredients: '' });
                        showToast('Recette ajout√©e avec succ√®s', 'success');
                    }
                } catch (error) {
                    showToast('Erreur lors de l\'ajout de la recette', 'error');
                }
            };
            
            const addRecipeToList = async (recipeId) => {
                try {
                    const response = await fetch(`${API_BASE}/api/recipes/${recipeId}/add-to-list`, {
                        method: 'POST',
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        await fetchShoppingList();
                        showToast(`${result.added_count} ingr√©dients ajout√©s pour "${result.recipe_name}"`, 'success');
                    }
                } catch (error) {
                    showToast('Erreur lors de l\'ajout des ingr√©dients', 'error');
                }
            };
            
            // Autres fonctions existantes...
            const checkPrices = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_BASE}/api/check-prices`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ notify: true }),
                    });
                    
                    const result = await response.json();
                    await fetchPriceAlerts();
                    showToast(`V√©rification termin√©e: ${result.alerts_found} alertes trouv√©es`, 'info');
                } catch (error) {
                    showToast('Erreur lors de la v√©rification des prix', 'error');
                } finally {
                    setLoading(false);
                }
            };
            
            const checkPromotions = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_BASE}/api/check-promotions`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ notify: true }),
                    });
                    
                    const result = await response.json();
                    await fetchPromotions();
                    showToast(`V√©rification termin√©e: ${result.promotions_found} promotions trouv√©es`, 'info');
                } catch (error) {
                    showToast('Erreur lors de la v√©rification des promotions', 'error');
                } finally {
                    setLoading(false);
                }
            };
            
            const sendTestEmail = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_BASE}/api/send-test-email`, {
                        method: 'POST',
                    });
                    
                    if (response.ok) {
                        showToast('Email de test envoy√© avec succ√®s', 'success');
                    } else {
                        showToast('Erreur lors de l\'envoi de l\'email', 'error');
                    }
                } catch (error) {
                    showToast('Erreur lors de l\'envoi de l\'email', 'error');
                } finally {
                    setLoading(false);
                }
            };
            
            // Cat√©gories pr√©d√©finies
            const categories = [
                'Fruits et l√©gumes', 'Viandes et poissons', 'Produits laitiers',
                'Boulangerie', '√âpicerie', 'Surgel√©s', 'Boissons', 'Hygi√®ne', 'Divers'
            ];
            
            // Unit√©s disponibles pour Jow
            const availableUnits = [
                'g', 'kg', 'ml', 'l', 'cl', 'dl',
                'unit√©', 'pi√®ce', 'tranche', 'gousse',
                'cuill√®re √† soupe', 'cuill√®re √† caf√©',
                'tasse', 'verre', 'pinc√©e'
            ];
            
            // Rendu de l'interface
            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
                    {/* Toast de notification */}
                    {toast && (
                        <Toast
                            message={toast.message}
                            type={toast.type}
                            onClose={() => setToast(null)}
                        />
                    )}
                    
                    {/* En-t√™te */}
                    <header className="bg-white shadow-lg">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center py-4">
                                <div className="flex items-center">
                                    <div className="bg-gradient-to-r from-blue-500 to-purple-600 p-3 rounded-xl">
                                        <i className="fas fa-shopping-cart text-white text-xl"></i>
                                    </div>
                                    <div className="ml-4">
                                        <h1 className="text-2xl font-bold text-gray-900">Smart Shopping</h1>
                                        <p className="text-sm text-gray-500 flex items-center">
                                            <span className="w-2 h-2 bg-green-400 rounded-full pulse-dot mr-2"></span>
                                            Raspberry Pi ‚Ä¢ En ligne
                                        </p>
                                    </div>
                                </div>
                                
                                <div className="flex items-center space-x-4">
                                    <button
                                        onClick={loadAllData}
                                        disabled={loading}
                                        className="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"
                                    >
                                        <i className={`fas fa-sync-alt ${loading ? 'animate-spin' : ''}`}></i>
                                    </button>
                                    
                                    <div className="flex space-x-2">
                                        <div className="text-center">
                                            <div className="text-lg font-bold text-blue-600">{stats.shopping_list_items || 0}</div>
                                            <div className="text-xs text-gray-500">√Ä acheter</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-lg font-bold text-green-600">{stats.active_promotions || 0}</div>
                                            <div className="text-xs text-gray-500">Promos</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-lg font-bold text-red-600">{stats.price_alerts || 0}</div>
                                            <div className="text-xs text-gray-500">Alertes</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>
                    
                    {/* Navigation */}
                    <nav className="bg-white border-b border-gray-200">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex space-x-8">
                                {[
                                    { id: 'shopping', icon: 'fas fa-list', label: 'Liste de courses' },
                                    { id: 'recipes', icon: 'fas fa-utensils', label: 'Recettes' },
                                    { id: 'prices', icon: 'fas fa-tags', label: 'Prix & Promos' },
                                    { id: 'settings', icon: 'fas fa-cog', label: 'Param√®tres' }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`flex items-center px-3 py-4 text-sm font-medium border-b-2 transition-colors ${
                                            activeTab === tab.id
                                                ? 'border-blue-500 text-blue-600'
                                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                        }`}
                                    >
                                        <i className={`${tab.icon} mr-2`}></i>
                                        {tab.label}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </nav>
                    
                    {/* Contenu principal */}
                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {/* Onglet Liste de courses */}
                        {activeTab === 'shopping' && (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                {/* Ajout d'articles */}
                                <div className="lg:col-span-2 space-y-6">
                                    <div className="bg-white rounded-xl shadow-lg p-6 slide-in">
                                        <h2 className="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                                            <i className="fas fa-plus-circle text-blue-500 mr-2"></i>
                                            Ajouter un article
                                        </h2>
                                        
                                        <div className="flex flex-col sm:flex-row gap-3">
                                            <div className="flex-1">
                                                <input
                                                    type="text"
                                                    value={newItem}
                                                    onChange={(e) => setNewItem(e.target.value)}
                                                    placeholder="Nom de l'article..."
                                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                    onKeyPress={(e) => e.key === 'Enter' && addItem(newItem)}
                                                />
                                            </div>
                                            
                                            <select
                                                value={newCategory}
                                                onChange={(e) => setNewCategory(e.target.value)}
                                                className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                            >
                                                {categories.map(cat => (
                                                    <option key={cat} value={cat}>{cat}</option>
                                                ))}
                                            </select>
                                            
                                            <button
                                                onClick={() => addItem(newItem)}
                                                disabled={!newItem.trim()}
                                                className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 transition-colors"
                                            >
                                                <i className="fas fa-plus mr-1"></i>
                                                Ajouter
                                            </button>
                                        </div>
                                    </div>
                                    
                                    {/* Liste de courses */}
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <div className="flex justify-between items-center mb-4">
                                            <h2 className="text-xl font-semibold text-gray-900">Ma liste de courses</h2>
                                            <span className="text-sm text-gray-500">
                                                {shoppingList.filter(item => !item.checked).length} articles √† acheter
                                            </span>
                                        </div>
                                        
                                        {shoppingList.length === 0 ? (
                                            <div className="text-center py-8">
                                                <i className="fas fa-shopping-basket text-4xl text-gray-300 mb-3"></i>
                                                <p className="text-gray-500">Votre liste est vide</p>
                                                <p className="text-sm text-gray-400">Ajoutez des articles ci-dessus</p>
                                            </div>
                                        ) : (
                                            <div className="space-y-2">
                                                {/* Articles non coch√©s */}
                                                {shoppingList.filter(item => !item.checked).map(item => (
                                                    <div key={item.id} className="flex items-center p-3 bg-gray-50 rounded-lg hover-lift">
                                                        <input
                                                            type="checkbox"
                                                            checked={item.checked}
                                                            onChange={(e) => toggleItem(item.id, e.target.checked)}
                                                            className="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                                                        />
                                                        <div className="ml-3 flex-1">
                                                            <div className="font-medium text-gray-900">{item.name}</div>
                                                            <div className="text-sm text-gray-500">{item.category}</div>
                                                        </div>
                                                        <button
                                                            onClick={() => removeItem(item.id)}
                                                            className="text-red-500 hover:text-red-700 p-1"
                                                        >
                                                            <i className="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                ))}
                                                
                                                {/* Articles coch√©s */}
                                                {shoppingList.filter(item => item.checked).length > 0 && (
                                                    <div className="pt-4 border-t border-gray-200">
                                                        <h3 className="text-sm font-medium text-gray-500 mb-2">Articles achet√©s</h3>
                                                        {shoppingList.filter(item => item.checked).map(item => (
                                                            <div key={item.id} className="flex items-center p-3 bg-green-50 rounded-lg opacity-75">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={item.checked}
                                                                    onChange={(e) => toggleItem(item.id, e.target.checked)}
                                                                    className="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"
                                                                />
                                                                <div className="ml-3 flex-1">
                                                                    <div className="font-medium text-gray-700 line-through">{item.name}</div>
                                                                    <div className="text-sm text-gray-500">{item.category}</div>
                                                                </div>
                                                                <button
                                                                    onClick={() => removeItem(item.id)}
                                                                    className="text-red-500 hover:text-red-700 p-1"
                                                                >
                                                                    <i className="fas fa-trash"></i>
                                                                </button>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                </div>
                                
                                {/* Suggestions intelligentes */}
                                <div className="space-y-6">
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                            <i className="fas fa-lightbulb text-yellow-500 mr-2"></i>
                                            Suggestions intelligentes
                                        </h3>
                                        
                                        {frequentItems.length === 0 ? (
                                            <p className="text-gray-500 text-sm">Aucune suggestion pour le moment</p>
                                        ) : (
                                            <div className="space-y-2">
                                                {frequentItems.slice(0, 5).map(item => (
                                                    <button
                                                        key={item.name}
                                                        onClick={() => addItem(item.name, item.category)}
                                                        className="w-full text-left p-3 bg-yellow-50 hover:bg-yellow-100 rounded-lg transition-colors"
                                                    >
                                                        <div className="font-medium text-gray-900">{item.name}</div>
                                                        <div className="text-sm text-gray-500">
                                                            {item.category} ‚Ä¢ Utilis√© {item.usage_count} fois
                                                        </div>
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                    
                                    {/* Actions rapides */}
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <h3 className="text-lg font-semibold text-gray-900 mb-4">Actions rapides</h3>
                                        <div className="space-y-3">
                                            <button
                                                onClick={checkPrices}
                                                disabled={loading}
                                                className="w-full flex items-center justify-center px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-gray-300 transition-colors"
                                            >
                                                <i className={`fas fa-search mr-2 ${loading ? 'animate-spin' : ''}`}></i>
                                                V√©rifier les prix
                                            </button>
                                            
                                            <button
                                                onClick={checkPromotions}
                                                disabled={loading}
                                                className="w-full flex items-center justify-center px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 transition-colors"
                                            >
                                                <i className={`fas fa-percentage mr-2 ${loading ? 'animate-spin' : ''}`}></i>
                                                V√©rifier les promos
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {/* Onglet Recettes */}
                        {activeTab === 'recipes' && (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                {/* Mes recettes */}
                                <div className="space-y-6">
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <h2 className="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                                            <i className="fas fa-utensils text-green-500 mr-2"></i>
                                            Mes recettes
                                        </h2>
                                        
                                        {recipes.length === 0 ? (
                                            <div className="text-center py-8">
                                                <i className="fas fa-book-open text-4xl text-gray-300 mb-3"></i>
                                                <p className="text-gray-500">Aucune recette pour le moment</p>
                                            </div>
                                        ) : (
                                            <div className="space-y-4">
                                                {recipes.map(recipe => (
                                                    <div key={recipe.id} className="border border-gray-200 rounded-lg p-4 hover-lift">
                                                        <div className="flex justify-between items-start mb-2">
                                                            <h3 className="font-medium text-gray-900">{recipe.name}</h3>
                                                            <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                                                {recipe.source}
                                                            </span>
                                                        </div>
                                                        
                                                        <div className="text-sm text-gray-600 mb-3">
                                                            Pour {recipe.servings} personnes
                                                        </div>
                                                        
                                                        <div className="text-sm text-gray-600 mb-3">
                                                            <strong>Ingr√©dients:</strong>
                                                            <ul className="list-disc list-inside mt-1">
                                                                {recipe.ingredients?.slice(0, 3).map((ingredient, index) => (
                                                                    <li key={index}>{ingredient}</li>
                                                                ))}
                                                                {recipe.ingredients?.length > 3 && (
                                                                    <li className="text-gray-400">
                                                                        ... et {recipe.ingredients.length - 3} autres
                                                                    </li>
                                                                )}
                                                            </ul>
                                                        </div>
                                                        
                                                        <button
                                                            onClick={() => addRecipeToList(recipe.id)}
                                                            className="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors"
                                                        >
                                                            <i className="fas fa-cart-plus mr-2"></i>
                                                            Ajouter √† la liste
                                                        </button>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>
                                
                                {/* Section Jow + Ajouter une recette */}
                                <div className="space-y-6">
                                    {/* RECETTES JOW INT√âGR√âES */}
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                            <i className="fas fa-globe text-purple-500 mr-2"></i>
                                            Recettes Jow
                                        </h3>
                                        
                                        {/* Recherche Jow */}
                                        <div className="mb-4">
                                            <div className="flex gap-2">
                                                <input
                                                    type="text"
                                                    placeholder="Rechercher sur Jow..."
                                                    value={jowSearchQuery}
                                                    onChange={(e) => setJowSearchQuery(e.target.value)}
                                                    className="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                                                    onKeyPress={(e) => e.key === 'Enter' && searchJowRecipes()}
                                                />
                                                <button
                                                    onClick={searchJowRecipes}
                                                    disabled={loadingJow || !jowSearchQuery.trim()}
                                                    className="px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 transition-colors"
                                                >
                                                    {loadingJow ? <i className="fas fa-spinner fa-spin"></i> : <i className="fas fa-search"></i>}
                                                </button>
                                            </div>
                                        </div>
                                        
                                        {/* R√©sultats Jow */}
                                        <div className="space-y-4 max-h-96 overflow-y-auto">
                                            {jowRecipes.map(recipe => (
                                                <div key={recipe.id} className="border border-purple-200 rounded-lg p-4 bg-purple-50">
                                                    <div className="flex justify-between items-start mb-3">
                                                        <div>
                                                            <h4 className="font-semibold text-gray-900">{recipe.name}</h4>
                                                            <p className="text-sm text-gray-600">
                                                                üçΩÔ∏è {recipe.servings} portions ‚Ä¢ ‚è±Ô∏è {recipe.prepTime} min
                                                            </p>
                                                        </div>
                                                        <span className="text-xs bg-purple-600 text-white px-2 py-1 rounded">
                                                            Jow
                                                        </span>
                                                    </div>
                                                    
                                                    {/* Ingr√©dients avec quantit√©s ajustables */}
                                                    <div className="mb-4">
                                                        <p className="text-sm font-medium text-gray-700 mb-2">
                                                            Ingr√©dients (modifiables) :
                                                        </p>
                                                        <div className="space-y-2">
                                                            {recipe.ingredients.map((ingredient, idx) => (
                                                                <div key={idx} className="jow-ingredient-item flex items-center justify-between py-2 px-3 bg-white rounded border">
                                                                    <span className="text-sm text-gray-700 flex-1">{ingredient.name}</span>
                                                                    <div className="flex items-center gap-2">
                                                                        <input
                                                                            type="number"
                                                                            value={ingredient.quantity}
                                                                            onChange={(e) => updateJowIngredientQuantity(recipe.id, idx, e.target.value)}
                                                                            className="quantity-input p-1 border border-gray-300 rounded text-center text-sm"
                                                                            step="0.1"
                                                                            min="0"
                                                                        />
                                                                        <select
                                                                            value={ingredient.unit}
                                                                            onChange={(e) => updateJowIngredientUnit(recipe.id, idx, e.target.value)}
                                                                            className="unit-select p-1 border border-gray-300 rounded text-xs"
                                                                        >
                                                                            {availableUnits.map(unit => (
                                                                                <option key={unit} value={unit}>{unit}</option>
                                                                            ))}
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                    
                                                    <button
                                                        onClick={() => addJowRecipeToList(recipe)}
                                                        disabled={loading}
                                                        className="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 disabled:bg-gray-300 transition-colors font-medium"
                                                    >
                                                        {loading ? (
                                                            <><i className="fas fa-spinner fa-spin mr-2"></i>Ajout en cours...</>
                                                        ) : (
                                                            <><i className="fas fa-magic mr-2"></i>Ajouter avec consolidation intelligente</>
                                                        )}
                                                    </button>
                                                </div>
                                            ))}
                                            
                                            {jowRecipes.length === 0 && !loadingJow && jowSearchQuery && (
                                                <p className="text-gray-500 text-center py-4">
                                                    Aucune recette trouv√©e pour "{jowSearchQuery}"
                                                </p>
                                            )}
                                            
                                            {jowRecipes.length === 0 && !loadingJow && !jowSearchQuery && (
                                                <div className="text-center py-8">
                                                    <i className="fas fa-search text-3xl text-gray-300 mb-3"></i>
                                                    <p className="text-gray-500">Recherchez des recettes Jow</p>
                                                    <p className="text-sm text-gray-400">Ex: "p√¢tes", "poulet", "salade"...</p>
                                                </div>
                                            )}
                                            
                                            {loadingJow && (
                                                <div className="text-center py-8">
                                                    <i className="fas fa-spinner fa-spin text-2xl text-purple-600 mb-3"></i>
                                                    <p className="text-gray-600">Recherche sur Jow en cours...</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    
                                    {/* Ajouter une recette personnalis√©e */}
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <h2 className="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                                            <i className="fas fa-plus-circle text-blue-500 mr-2"></i>
                                            Ajouter une recette
                                        </h2>
                                        
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                                    Nom de la recette
                                                </label>
                                                <input
                                                    type="text"
                                                    value={newRecipe.name}
                                                    onChange={(e) => setNewRecipe({...newRecipe, name: e.target.value})}
                                                    placeholder="Ex: P√¢tes carbonara"
                                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                />
                                            </div>
                                            
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                                    Ingr√©dients (un par ligne)
                                                </label>
                                                <textarea
                                                    value={newRecipe.ingredients}
                                                    onChange={(e) => setNewRecipe({...newRecipe, ingredients: e.target.value})}
                                                    placeholder="p√¢tes&#10;lardons&#10;≈ìufs&#10;parmesan&#10;cr√®me fra√Æche"
                                                    rows={6}
                                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                />
                                            </div>
                                            
                                            <button
                                                onClick={addRecipe}
                                                disabled={!newRecipe.name.trim() || !newRecipe.ingredients.trim()}
                                                className="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 transition-colors"
                                            >
                                                <i className="fas fa-save mr-2"></i>
                                                Sauvegarder la recette
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {/* Onglet Prix & Promotions */}
                        {activeTab === 'prices' && (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                {/* Alertes de prix */}
                                <div className="space-y-6">
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <h2 className="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                                            <i className="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                                            Alertes de prix Amazon
                                        </h2>
                                        
                                        {priceAlerts.length === 0 ? (
                                            <div className="text-center py-8">
                                                <i className="fas fa-shield-alt text-4xl text-gray-300 mb-3"></i>
                                                <p className="text-gray-500">Aucune alerte pour le moment</p>
                                                <p className="text-sm text-gray-400">Les erreurs de prix seront d√©tect√©es automatiquement</p>
                                            </div>
                                        ) : (
                                            <div className="space-y-4">
                                                {priceAlerts.slice(0, 5).map(alert => (
                                                    <div key={alert.id} className="border-l-4 border-red-500 bg-red-50 p-4 rounded-r-lg">
                                                        <div className="flex justify-between items-start">
                                                            <div className="flex-1">
                                                                <h3 className="font-medium text-gray-900">{alert.product_name}</h3>
                                                                <p className="text-sm text-gray-600 mt-1">{alert.store}</p>
                                                                <div className="flex items-center mt-2 space-x-4">
                                                                    <span className="text-sm text-gray-500 line-through">
                                                                        {alert.original_price}‚Ç¨
                                                                    </span>
                                                                    <span className="text-lg font-bold text-red-600">
                                                                        {alert.current_price}‚Ç¨
                                                                    </span>
                                                                    <span className="text-sm bg-red-100 text-red-800 px-2 py-1 rounded">
                                                                        -{alert.discount_percentage}%
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <span className="text-xs text-gray-500">
                                                                {new Date(alert.created_at).toLocaleDateString()}
                                                            </span>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>
                                
                                {/* Promotions locales */}
                                <div className="space-y-6">
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <h2 className="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                                            <i className="fas fa-percentage text-green-500 mr-2"></i>
                                            Promotions locales
                                        </h2>
                                        
                                        {promotions.length === 0 ? (
                                            <div className="text-center py-8">
                                                <i className="fas fa-tag text-4xl text-gray-300 mb-3"></i>
                                                <p className="text-gray-500">Aucune promotion pour le moment</p>
                                                <p className="text-sm text-gray-400">V√©rifications automatiques quotidiennes</p>
                                            </div>
                                        ) : (
                                            <div className="space-y-4">
                                                {promotions.slice(0, 8).map(promo => (
                                                    <div key={promo.id} className="border border-gray-200 rounded-lg p-4 hover-lift">
                                                        <div className="flex justify-between items-start mb-2">
                                                            <h3 className="font-medium text-gray-900">{promo.product_name}</h3>
                                                            <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                                                {promo.store}
                                                            </span>
                                                        </div>
                                                        
                                                        <div className="flex items-center justify-between">
                                                            <div className="flex items-center space-x-2">
                                                                <span className="text-sm text-gray-500 line-through">
                                                                    {promo.original_price}‚Ç¨
                                                                </span>
                                                                <span className="font-bold text-green-600">
                                                                    {promo.promo_price}‚Ç¨
                                                                </span>
                                                                <span className="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">
                                                                    -{promo.discount_percentage}%
                                                                </span>
                                                            </div>
                                                            
                                                            <span className="text-xs text-gray-500">
                                                                Jusqu'au {new Date(promo.valid_until).toLocaleDateString()}
                                                            </span>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {/* Onglet Param√®tres */}
                        {activeTab === 'settings' && (
                            <div className="max-w-2xl mx-auto space-y-8">
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h2 className="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                                        <i className="fas fa-cog text-gray-500 mr-2"></i>
                                        Param√®tres et configuration
                                    </h2>
                                    
                                    {/* Informations syst√®me */}
                                    <div className="space-y-6">
                                        <div>
                                            <h3 className="text-lg font-medium text-gray-900 mb-3">Informations syst√®me</h3>
                                            <div className="bg-gray-50 rounded-lg p-4 space-y-2">
                                                <div className="flex justify-between">
                                                    <span className="text-gray-600">Plateforme:</span>
                                                    <span className="font-medium">Raspberry Pi Ubuntu Server</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-gray-600">Service:</span>
                                                    <span className="font-medium text-green-600">
                                                        <i className="fas fa-circle text-xs mr-1"></i>
                                                        En ligne
                                                    </span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-gray-600">Base de donn√©es:</span>
                                                    <span className="font-medium">SQLite</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-gray-600">Articles en liste:</span>
                                                    <span className="font-medium">{stats.shopping_list_items || 0}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-gray-600">Recettes Jow:</span>
                                                    <span className="font-medium text-purple-600">
                                                        <i className="fas fa-globe mr-1"></i>
                                                        Connect√©
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        {/* Configuration email */}
                                        <div>
                                            <h3 className="text-lg font-medium text-gray-900 mb-3">Notifications email</h3>
                                            <div className="space-y-3">
                                                <p className="text-sm text-gray-600">
                                                    Les notifications sont envoy√©es √†: <strong>rapherv@gmail.com</strong>
                                                </p>
                                                
                                                <button
                                                    onClick={sendTestEmail}
                                                    disabled={loading}
                                                    className="flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 transition-colors"
                                                >
                                                    <i className={`fas fa-envelope mr-2 ${loading ? 'animate-spin' : ''}`}></i>
                                                    Envoyer un email de test
                                                </button>
                                            </div>
                                        </div>
                                        
                                        {/* V√©rifications automatiques */}
                                        <div>
                                            <h3 className="text-lg font-medium text-gray-900 mb-3">V√©rifications automatiques</h3>
                                            <div className="bg-gray-50 rounded-lg p-4 space-y-2">
                                                <div className="flex justify-between items-center">
                                                    <span className="text-gray-600">Prix Amazon:</span>
                                                    <span className="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                                        Toutes les 2 heures
                                                    </span>
                                                </div>
                                                <div className="flex justify-between items-center">
                                                    <span className="text-gray-600">Promotions locales:</span>
                                                    <span className="text-sm bg-green-100 text-green-800 px-2 py-1 rounded">
                                                        Quotidienne √† 8h
                                                    </span>
                                                </div>
                                                <div className="flex justify-between items-center">
                                                    <span className="text-gray-600">Sync Jow:</span>
                                                    <span className="text-sm bg-purple-100 text-purple-800 px-2 py-1 rounded">
                                                        En temps r√©el
                                                    </span>
                                                </div>
                                                <div className="flex justify-between items-center">
                                                    <span className="text-gray-600">Nettoyage base:</span>
                                                    <span className="text-sm bg-gray-100 text-gray-800 px-2 py-1 rounded">
                                                        Dimanche √† 2h
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        {/* Actions de maintenance */}
                                        <div>
                                            <h3 className="text-lg font-medium text-gray-900 mb-3">Maintenance</h3>
                                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                                <button
                                                    onClick={loadAllData}
                                                    disabled={loading}
                                                    className="flex items-center justify-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:bg-gray-300 transition-colors"
                                                >
                                                    <i className={`fas fa-sync-alt mr-2 ${loading ? 'animate-spin' : ''}`}></i>
                                                    Actualiser donn√©es
                                                </button>
                                                
                                                <button className="flex items-center justify-center px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors">
                                                    <i className="fas fa-broom mr-2"></i>
                                                    Nettoyer anciens
                                                </button>
                                                
                                                <button className="flex items-center justify-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                                                    <i className="fas fa-globe mr-2"></i>
                                                    Test API Jow
                                                </button>
                                                
                                                <button className="flex items-center justify-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                                                    <i className="fas fa-download mr-2"></i>
                                                    Export donn√©es
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* Aide et documentation */}
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h3 className="text-lg font-medium text-gray-900 mb-4">Aide et fonctionnalit√©s</h3>
                                    <div className="space-y-4 text-sm">
                                        <div className="flex items-start">
                                            <i className="fas fa-magic text-purple-500 mt-1 mr-3"></i>
                                            <div>
                                                <strong>Consolidation intelligente Jow</strong> : D√©tecte automatiquement les doublons d'ingr√©dients 
                                                entre recettes et consolide les quantit√©s (ex: 200g + 300g = 500g de p√¢tes)
                                            </div>
                                        </div>
                                        
                                        <div className="flex items-start">
                                            <i className="fas fa-adjust text-blue-500 mt-1 mr-3"></i>
                                            <div>
                                                <strong>Quantit√©s ajustables</strong> : Modifiez les quantit√©s et unit√©s directement 
                                                dans l'interface avant d'ajouter √† votre liste
                                            </div>
                                        </div>
                                        
                                        <div className="flex items-start">
                                            <i className="fas fa-globe text-green-500 mt-1 mr-3"></i>
                                            <div>
                                                <strong>Recherche Jow en temps r√©el</strong> : Acc√®s direct aux milliers de recettes 
                                                Jow avec ingr√©dients et quantit√©s automatiques
                                            </div>
                                        </div>
                                        
                                        <div className="flex items-start">
                                            <i className="fas fa-brain text-yellow-500 mt-1 mr-3"></i>
                                            <div>
                                                <strong>Suggestions intelligentes</strong> : Le syst√®me apprend de vos habitudes 
                                                et vous propose automatiquement les articles que vous achetez r√©guli√®rement
                                            </div>
                                        </div>
                                        
                                        <div className="flex items-start">
                                            <i className="fas fa-tags text-red-500 mt-1 mr-3"></i>
                                            <div>
                                                <strong>D√©tection d'erreurs de prix</strong> : Surveillance automatique des r√©ductions 
                                                sup√©rieures √† 90% qui peuvent √™tre des erreurs de prix sur Amazon
                                            </div>
                                        </div>
                                        
                                        <div className="flex items-start">
                                            <i className="fas fa-envelope text-purple-500 mt-1 mr-3"></i>
                                            <div>
                                                <strong>Notifications email</strong> : Alertes automatiques par email 
                                                pour les bonnes affaires d√©tect√©es et promotions locales
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                    
                    {/* Footer */}
                    <footer className="bg-white border-t border-gray-200 mt-12">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                            <div className="flex flex-col md:flex-row justify-between items-center">
                                <div className="flex items-center text-sm text-gray-500">
                                    <i className="fas fa-heart text-red-500 mr-1"></i>
                                    D√©velopp√© avec ‚ù§Ô∏è pour optimiser vos courses
                                </div>
                                
                                <div className="flex items-center mt-4 md:mt-0 space-x-4 text-sm text-gray-500">
                                    <span>Smart Shopping Assistant v2.0</span>
                                    <span>‚Ä¢</span>
                                    <span>Jow Integration</span>
                                    <span>‚Ä¢</span>
                                    <span>Raspberry Pi</span>
                                    <span>‚Ä¢</span>
                                    <span>{new Date().getFullYear()}</span>
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        };
        
        // Rendu de l'application
        ReactDOM.render(<SmartShoppingApp />, document.getElementById('root'));
    </script>
</body>
</html>
